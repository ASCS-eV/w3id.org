Header set Access-Control-Allow-Origin *

# MIME types for RDF serializations
AddType application/rdf+xml .rdf
AddType application/rdf+xml .owl
AddType text/turtle .ttl
AddType application/n-triples .nt
AddType application/ld+json .json
AddType application/ld+json .jsonld

Options +FollowSymLinks
RewriteEngine on

# =============================================================================
# Harbour Credentials - Static GitHub Pages resolution
# Pattern: /reachhaven/harbour/{domain}/{version}[/][shapes]
# Target:  reachhaven.github.io/harbour-credentials/w3id/reachhaven/harbour/...
# =============================================================================

# --- Turtle / RDF-XML ---

# Ontology (versioned)
RewriteCond %{HTTP_ACCEPT} text/turtle [OR]
RewriteCond %{HTTP_ACCEPT} application/rdf\+xml
RewriteRule ^harbour/([^/]+)/(v[0-9]+|latest)/?$ https://reachhaven.github.io/harbour-credentials/w3id/reachhaven/harbour/$1/$2/ontology.ttl [R=303,L]

# SHACL shapes (versioned)
RewriteCond %{HTTP_ACCEPT} text/turtle [OR]
RewriteCond %{HTTP_ACCEPT} application/rdf\+xml
RewriteRule ^harbour/([^/]+)/(v[0-9]+|latest)/shapes/?$ https://reachhaven.github.io/harbour-credentials/w3id/reachhaven/harbour/$1/$2/shapes.ttl [R=303,L]

# --- JSON-LD ---

# JSON-LD context (versioned)
RewriteCond %{HTTP_ACCEPT} application/ld\+json [OR]
RewriteCond %{HTTP_ACCEPT} application/json
RewriteRule ^harbour/([^/]+)/(v[0-9]+|latest)/?$ https://reachhaven.github.io/harbour-credentials/w3id/reachhaven/harbour/$1/$2/context.jsonld [R=303,L]

# JSON-LD shapes (versioned) — no JSON-LD shapes published, serve Turtle
RewriteCond %{HTTP_ACCEPT} application/ld\+json [OR]
RewriteCond %{HTTP_ACCEPT} application/json
RewriteRule ^harbour/([^/]+)/(v[0-9]+|latest)/shapes/?$ https://reachhaven.github.io/harbour-credentials/w3id/reachhaven/harbour/$1/$2/shapes.ttl [R=303,L]

# --- Bare IRI (no version) -> latest ---

# Turtle / RDF-XML
RewriteCond %{HTTP_ACCEPT} text/turtle [OR]
RewriteCond %{HTTP_ACCEPT} application/rdf\+xml
RewriteRule ^harbour/([^/]+)/?$ https://reachhaven.github.io/harbour-credentials/w3id/reachhaven/harbour/$1/latest/ontology.ttl [R=303,L]

# JSON-LD
RewriteCond %{HTTP_ACCEPT} application/ld\+json [OR]
RewriteCond %{HTTP_ACCEPT} application/json
RewriteRule ^harbour/([^/]+)/?$ https://reachhaven.github.io/harbour-credentials/w3id/reachhaven/harbour/$1/latest/context.jsonld [R=303,L]

# -----------------------------------------------------------------------------
# HTML fallback — redirect browsers to documentation
# -----------------------------------------------------------------------------
RewriteRule ^harbour/([^/]+)/(v[0-9]+|latest)/?$ https://reachhaven.github.io/harbour-credentials/ [R=303,L]
RewriteRule ^harbour/([^/]+)/(v[0-9]+|latest)/shapes/?$ https://reachhaven.github.io/harbour-credentials/ [R=303,L]
RewriteRule ^harbour/([^/]+)/?$ https://reachhaven.github.io/harbour-credentials/ [R=303,L]

# -----------------------------------------------------------------------------
# Root redirect to documentation
# -----------------------------------------------------------------------------
RewriteRule ^$ https://reachhaven.github.io/harbour-credentials/ [R=303,L]
