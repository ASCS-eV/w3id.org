Header set Access-Control-Allow-Origin *

# MIME types for RDF serializations
AddType application/rdf+xml .rdf
AddType application/rdf+xml .owl
AddType text/turtle .ttl
AddType application/n-triples .nt
AddType application/ld+json .json
AddType application/ld+json .jsonld

Options +FollowSymLinks
RewriteEngine on

# =============================================================================
# SimpulseID Credential Ontologies - Static GitHub Pages resolution
# Pattern: /ascs-ev/simpulse-id/{ontology}/{version}[/]
# Target:  ascs-ev.github.io/credentials/w3id/ascs-ev/simpulse-id/...
# =============================================================================

# --- Turtle / RDF-XML ---

# Ontology (versioned)
RewriteCond %{HTTP_ACCEPT} text/turtle [OR]
RewriteCond %{HTTP_ACCEPT} application/rdf\+xml
RewriteRule ^([^/]+)/(v[0-9]+|latest)/?$ https://ascs-ev.github.io/credentials/w3id/ascs-ev/simpulse-id/$1/$2/ontology.ttl [R=303,L]

# SHACL shapes (versioned)
RewriteCond %{HTTP_ACCEPT} text/turtle [OR]
RewriteCond %{HTTP_ACCEPT} application/rdf\+xml
RewriteRule ^([^/]+)/(v[0-9]+|latest)/shapes/?$ https://ascs-ev.github.io/credentials/w3id/ascs-ev/simpulse-id/$1/$2/shapes.ttl [R=303,L]

# --- JSON-LD ---

# JSON-LD context (versioned)
RewriteCond %{HTTP_ACCEPT} application/ld\+json [OR]
RewriteCond %{HTTP_ACCEPT} application/json
RewriteRule ^([^/]+)/(v[0-9]+|latest)/?$ https://ascs-ev.github.io/credentials/w3id/ascs-ev/simpulse-id/$1/$2/context.jsonld [R=303,L]

# JSON-LD shapes (versioned) — no JSON-LD shapes published, serve Turtle
RewriteCond %{HTTP_ACCEPT} application/ld\+json [OR]
RewriteCond %{HTTP_ACCEPT} application/json
RewriteRule ^([^/]+)/(v[0-9]+|latest)/shapes/?$ https://ascs-ev.github.io/credentials/w3id/ascs-ev/simpulse-id/$1/$2/shapes.ttl [R=303,L]

# --- Bare IRI (no version) → latest ---

# Turtle / RDF-XML
RewriteCond %{HTTP_ACCEPT} text/turtle [OR]
RewriteCond %{HTTP_ACCEPT} application/rdf\+xml
RewriteRule ^([^/]+)/?$ https://ascs-ev.github.io/credentials/w3id/ascs-ev/simpulse-id/$1/latest/ontology.ttl [R=303,L]

# JSON-LD
RewriteCond %{HTTP_ACCEPT} application/ld\+json [OR]
RewriteCond %{HTTP_ACCEPT} application/json
RewriteRule ^([^/]+)/?$ https://ascs-ev.github.io/credentials/w3id/ascs-ev/simpulse-id/$1/latest/context.jsonld [R=303,L]

# -----------------------------------------------------------------------------
# HTML fallback — redirect browsers to repository
# -----------------------------------------------------------------------------
RewriteRule ^([^/]+)/(v[0-9]+|latest)/?$ https://github.com/ASCS-eV/credentials [R=303,L]
RewriteRule ^([^/]+)/(v[0-9]+|latest)/shapes/?$ https://github.com/ASCS-eV/credentials [R=303,L]
RewriteRule ^([^/]+)/?$ https://github.com/ASCS-eV/credentials [R=303,L]

# -----------------------------------------------------------------------------
# Root redirect to repository
# -----------------------------------------------------------------------------
RewriteRule ^$ https://github.com/ASCS-eV/credentials [R=303,L]
